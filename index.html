<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ally Hockey</title>

<style>
:root{
  --pink:#ff4fa3;--orange:#ff914d;--yellow:#ffd84d;
  --green:#4dd599;--blue:#4d8dff;--purple:#9b4dff;
  --bg:#0f1220;--card:#1a1f3c;--text:#fff;
  --muted:#b5b8ff;--border:#2a3060;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:linear-gradient(135deg,var(--purple),var(--blue),var(--green));
  color:var(--text);
}
header{text-align:center;padding:2rem 1rem 1rem}
main{background:var(--bg);border-radius:24px 24px 0 0;padding:1.5rem;margin-top:1rem}
.filters{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.75rem;margin-bottom:1rem}
input,select{padding:.5rem;border-radius:8px;border:none}
table{width:100%;border-collapse:collapse;display:none}
th,td{padding:.75rem;border-bottom:1px solid var(--border)}
.cards{display:grid;gap:.75rem}
.card{background:var(--card);border-radius:14px;padding:.75rem;border:1px solid var(--border)}
.card-header{display:flex;justify-content:space-between;align-items:center}
.card-sub{font-size:.8rem;color:var(--muted)}
.badges{display:flex;flex-wrap:wrap;gap:.25rem;margin:.5rem 0}
.badge{font-size:.7rem;padding:.25rem .45rem;border-radius:999px;font-weight:600;color:#000}
.expand{cursor:pointer;font-size:1.2rem}
.details{display:none;font-size:.85rem;margin-top:.5rem}
.button{background:var(--yellow);padding:.45rem .7rem;border-radius:8px;color:#000;text-decoration:none;font-size:.8rem;font-weight:600}
@media(min-width:768px){table{display:table}.cards{display:none}}
</style>
</head>

<body>

<header>
  <h1>Ally Hockey</h1>
  <p>A verified list of NHL players who have publicly supported Pride.</p>
</header>

<main>

<div class="filters">
  <input id="filter-name" placeholder="Search player">
  <select id="filter-team"><option value="">All teams</option></select>
  <select id="filter-season"><option value="">All seasons</option></select>
  <select id="filter-support"><option value="">All support types</option></select>
</div>

<table>
<thead>
<tr>
  <th>Player</th>
  <th>Team</th>
  <th>Season</th>
  <th>Support</th>
  <th></th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="cards"></div>

</main>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRiYFhrVaw_hJPY74tlc-Cr4K36CJjL_ROLWYvpuhgHGHdZu-6QVYNc3d2TFl4WrJoZlT21RDek-7Xp/pub?gid=0&single=true&output=csv";

const COLORS=["#ff4fa3","#ff914d","#ffd84d","#4dd599","#4d8dff","#9b4dff"];

const filterName=document.getElementById("filter-name");
const filterTeam=document.getElementById("filter-team");
const filterSeason=document.getElementById("filter-season");
const filterSupport=document.getElementById("filter-support");
const tableBody=document.querySelector("tbody");
const cards=document.querySelector(".cards");

let players=[];

/* SIMPLE CSV PARSER (Google Sheets safe) */
function parseCSV(text){
  const lines=text.trim().split("\n");
  const headers=lines.shift().split(",").map(h=>h.trim());
  return lines.map(line=>{
    const values=line.split(",").map(v=>v.trim());
    const obj={};
    headers.forEach((h,i)=>obj[h]=values[i]||"");
    return obj;
  });
}

function badge(text){
  const b=document.createElement("span");
  b.className="badge";
  b.style.background=COLORS[Math.floor(Math.random()*COLORS.length)];
  b.textContent=text;
  return b;
}

async function load(){
  const res=await fetch(CSV_URL);
  const text=await res.text();
  players=parseCSV(text);

  populateFilters();
  render();
}

function populateFilters(){
  [...new Set(players.map(p=>p.team).filter(Boolean))]
    .forEach(v=>filterTeam.append(new Option(v,v)));

  [...new Set(players.map(p=>p.season).filter(Boolean))]
    .forEach(v=>filterSeason.append(new Option(v,v)));

  [...new Set(players.flatMap(p=>(p.support_type||"").split("|").map(s=>s.trim())).filter(Boolean))]
    .forEach(v=>filterSupport.append(new Option(v,v)));
}

function render(){
  tableBody.innerHTML="";
  cards.innerHTML="";

  players.forEach(p=>{
    const types=(p.support_type||"").split("|").map(s=>s.trim());

    if(filterName.value && !p.player_name.toLowerCase().includes(filterName.value.toLowerCase())) return;
    if(filterTeam.value && p.team!==filterTeam.value) return;
    if(filterSeason.value && p.season!==filterSeason.value) return;
    if(filterSupport.value && !types.includes(filterSupport.value)) return;

    // TABLE
    const tr=document.createElement("tr");
    const tdBadges=document.createElement("td");
    types.forEach(t=>tdBadges.append(badge(t)));
    tr.innerHTML=`
      <td>${p.player_name}</td>
      <td>${p.team}</td>
      <td>${p.season}</td>
      <td></td>
      <td><a class="button" href="${p.fanatics_url||"#"}" target="_blank">Buy</a></td>
    `;
    tr.children[3].replaceWith(tdBadges);
    tableBody.append(tr);

    // CARD
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div class="card-header">
        <div>
          <div><strong>${p.player_name}</strong></div>
          <div class="card-sub">${p.team} · ${p.season}</div>
        </div>
        <div class="expand">+</div>
      </div>
      <div class="badges"></div>
      <a class="button" href="${p.fanatics_url||"#"}" target="_blank">Buy jersey</a>
      <div class="details">${p.support_details||""}</div>
    `;
    const bwrap=card.querySelector(".badges");
    types.forEach(t=>bwrap.append(badge(t)));
    const details=card.querySelector(".details");
    const expand=card.querySelector(".expand");
    expand.onclick=()=>{
      const open=details.style.display==="block";
      details.style.display=open?"none":"block";
      expand.textContent=open?"+":"–";
    };
    cards.append(card);
  });
}

filterName.oninput=render;
filterTeam.onchange=render;
filterSeason.onchange=render;
filterSupport.onchange=render;

load();
</script>

</body>
</html>
